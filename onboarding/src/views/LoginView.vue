<script lang="ts">
import { defineComponent, reactive, onMounted } from "vue";
import { useRouter } from "vue-router";
import { User, Errors } from "../interfaces/interfaces";
import { fetchUsers } from "../services/userService";

export default defineComponent({
  name: "LoginView",

  setup() {
    const router = useRouter();
    const state = reactive({
      email: '' as string,
      password: '' as string,
      errors: {
        email: '',
        password: '',
      } as Errors,
      users: [] as User[],
    });

    const loadUsers = async () => {
      state.users = await fetchUsers();
    };

    const validateForm = (): boolean => {
      state.errors = { email: '', password: '' };
      if (!state.email) {
        state.errors.email = 'Ikke en gyldig email';
      }
      if (!state.password) {
        state.errors.password = 'Mangler adgangskode';
      }
      return !state.errors.email && !state.errors.password;
    };

    const login = () => {
      if (validateForm()) {
        console.log('Validere'
        )
        const user = state.users.find(user => user.email === state.email && user.password === state.password);
        if (user) {
          router.push('/dashboard');
        } else {
          state.errors.email = 'Invalid email or password';
        }
      }
    };

    onMounted(() => {
      loadUsers();
    });

    return {
      state,
      login,
      email: state.email,
      password: state.password,
      errors: state.errors,
    };
  },
});
</script>


<template>
  <div class="flex flex-row h-screen">
    <div class="w-1/2  h-full ml-16 mt-12">
      <div class="mb-24">
        <svg width="120" height="22" viewBox="0 0 120 22" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M17.6804 2.82928L16.1005 4.45795C15.9576 4.43809 15.8905 4.33453 15.8147 4.26217C14.8095 3.35882 13.5853 2.73016 12.262 2.43772C9.75775 1.90003 7.47066 2.41502 5.45357 3.98269C3.79754 5.23902 2.70685 7.09293 2.41793 9.14252C2.0929 11.1535 2.54021 13.2123 3.67124 14.9112C4.80227 16.6101 6.53453 17.8252 8.52492 18.3159C11.2691 18.9798 13.7262 18.3301 15.8676 16.5056C15.9633 16.4247 16.0547 16.3396 16.1533 16.2517C16.1861 16.2573 16.2176 16.2688 16.2462 16.2857C16.7519 16.7922 17.2561 17.3015 17.7718 17.8236C17.7307 17.8794 17.6853 17.932 17.6361 17.9811C16.2196 19.2996 14.4626 20.2023 12.5605 20.5886C11.6428 20.7821 10.7019 20.8447 9.76632 20.7745C6.92211 20.5589 4.54073 19.3998 2.63649 17.2944C1.3234 15.8556 0.458073 14.0698 0.145123 12.153C-0.304947 9.53452 0.269769 6.8442 1.75163 4.63275C3.23349 2.42129 5.51042 0.855966 8.11636 0.257166C11.5877 -0.457862 14.6791 0.318166 17.3904 2.58526L17.6804 2.82928Z"
            fill="#003732" />
          <path
            d="M52.7574 16.9978C53.2349 17.5139 53.6846 18.0547 54.1046 18.618C54.0481 18.725 53.9656 18.8162 53.8646 18.8833C53.2771 19.3906 52.609 19.7976 51.8875 20.0878C51.0659 20.4248 50.2 20.6436 49.3161 20.7375C48.7366 20.8025 48.1528 20.82 47.5704 20.79C46.3443 20.7481 45.1441 20.4278 44.0619 19.8537C43.2602 19.4349 42.5526 18.8585 41.9824 18.1595C41.4121 17.4604 40.9911 16.6535 40.7449 15.7877C40.277 14.2921 40.277 12.6908 40.7449 11.1953C41.522 8.71541 43.2034 7.12647 45.7233 6.44975C47.2102 6.04071 48.7857 6.07723 50.2518 6.55473C52.6917 7.34353 54.2317 8.99916 54.906 11.445C55.1491 12.3218 55.2242 13.2362 55.1274 14.1406C55.1274 14.1959 55.1117 14.2498 55.1002 14.3207C55.0231 14.3307 54.9574 14.3434 54.8931 14.3463C54.7788 14.3463 54.6645 14.3463 54.5503 14.3463H43.1691C43.0256 14.3325 42.8807 14.3426 42.7405 14.3761C42.7362 14.4308 42.7362 14.4859 42.7405 14.5406C43.1234 16.5864 44.3119 17.9228 46.3319 18.496C48.2633 19.045 50.6303 18.6719 52.3032 17.3525L52.7574 16.9978ZM42.7877 12.458C42.8648 12.4704 42.9425 12.479 43.0205 12.4835C45.5633 12.5317 52.5132 12.5048 52.8289 12.4452C52.8243 12.2316 52.7862 12.0201 52.716 11.8181C52.2646 10.2377 51.2789 9.13677 49.7161 8.57213C48.9034 8.29006 48.0373 8.19309 47.1819 8.28838C46.4041 8.35357 45.6529 8.6 44.9891 9.00767C43.7762 9.761 43.0848 10.8676 42.7905 12.2381C42.7833 12.3083 42.7824 12.379 42.7877 12.4495V12.458Z"
            fill="#003732" />
          <path
            d="M100.219 14.3028C100.094 14.3509 99.9582 14.3665 99.825 14.3482H88.2724C88.1351 14.3342 87.9963 14.3443 87.8624 14.378C87.8574 14.4361 87.8574 14.4945 87.8624 14.5525C88.251 16.5969 89.4438 17.9319 91.4624 18.5008C93.3652 19.0385 95.6965 18.6781 97.3508 17.4098C97.5222 17.2778 97.6894 17.1402 97.8736 16.9927C98.1199 17.2401 98.3481 17.5047 98.5565 17.7843C98.785 18.051 99.0036 18.3263 99.2322 18.6043C99.1567 18.7231 99.0599 18.8269 98.9465 18.9108C98.3899 19.3818 97.7635 19.7646 97.0894 20.0457C96.2372 20.4053 95.3359 20.6371 94.4151 20.7338C93.8356 20.7976 93.2518 20.8147 92.6695 20.7849C91.4318 20.7423 90.221 20.415 89.1324 19.8287C88.3434 19.4102 87.6471 18.8386 87.0849 18.1476C86.5227 17.4567 86.106 16.6606 85.8596 15.8066C85.3713 14.2444 85.3908 12.5691 85.9153 11.0185C86.6625 8.79256 88.1753 7.29725 90.4209 6.56661C92.0277 6.03188 93.7656 6.0274 95.3751 6.55384C97.8308 7.34406 99.3665 9.01955 100.032 11.4824C100.264 12.3511 100.335 13.2542 100.244 14.1482C100.238 14.1978 100.228 14.2418 100.219 14.3028ZM97.9422 12.4401C97.9404 12.2365 97.9047 12.0347 97.8365 11.8428C97.3679 10.1801 96.3251 9.0536 94.6609 8.51449C93.8838 8.27495 93.0648 8.19956 92.2566 8.29318C91.5486 8.35626 90.8629 8.57118 90.2467 8.92308C88.9496 9.67074 88.2096 10.8071 87.9039 12.2429C87.8974 12.3099 87.8974 12.3773 87.9039 12.4443C87.9362 12.4589 87.9703 12.4693 88.0053 12.4755C91.2833 12.4755 94.5623 12.4755 97.8422 12.4755C97.877 12.4684 97.9107 12.4565 97.9422 12.4401Z"
            fill="#003732" />
          <path
            d="M70.3783 21.9987C70.3054 21.871 70.2569 21.7944 70.2169 21.715C67.7017 16.6663 65.1865 11.6171 62.6713 6.56744C62.6713 6.55183 62.6713 6.5263 62.6885 6.48232C62.7342 6.48232 62.787 6.46671 62.8413 6.46387C63.6033 6.43585 64.3662 6.44721 65.127 6.49792C65.7184 7.68112 66.297 8.88702 66.8855 10.0887C67.4741 11.2903 68.0598 12.5005 68.6483 13.6993C69.2369 14.8981 69.8183 16.1111 70.4354 17.3496C70.6697 16.9126 70.8469 16.5126 71.0383 16.1182C71.2297 15.7238 71.4211 15.3209 71.6097 14.9208L72.1982 13.6936L73.3411 11.2988C73.5316 10.9006 73.722 10.501 73.9125 10.1L74.5039 8.87283C74.6944 8.47465 74.8849 8.07552 75.0753 7.67544C75.2668 7.27679 75.4582 6.88097 75.6468 6.49792C76.4554 6.44676 77.2666 6.44676 78.0753 6.49792C78.091 6.60432 78.0196 6.68519 77.9781 6.77173C77.4362 7.86035 76.8943 8.94803 76.3524 10.0348L70.5711 21.6114C70.5226 21.7263 70.464 21.8356 70.3783 21.9987Z"
            fill="#003732" />
          <path
            d="M112.921 20.4857C112.18 20.5346 111.437 20.5407 110.696 20.5042C110.68 20.4435 110.669 20.3819 110.661 20.3197C110.661 20.2403 110.661 20.1608 110.661 20.0814V6.50153C110.72 6.48188 110.78 6.4681 110.841 6.46038C111.481 6.46038 112.121 6.46038 112.761 6.46038C112.804 6.4639 112.846 6.47054 112.887 6.48025C112.941 6.58473 112.958 6.70391 112.937 6.81932C112.937 7.59015 112.937 8.36098 112.937 9.13181V9.46947C113.057 9.49642 113.057 9.4042 113.08 9.35313C113.594 8.34218 114.396 7.5035 115.386 6.94133C116.374 6.35384 117.525 6.09489 118.671 6.20218C119.058 6.23219 119.443 6.2886 119.823 6.37101C119.865 6.38094 119.907 6.39796 119.965 6.41641C119.994 6.78882 120.001 7.16255 119.987 7.53577C119.987 7.90889 119.987 8.28201 119.987 8.67073C119.885 8.65229 119.81 8.64378 119.735 8.62533C119.092 8.46471 118.43 8.39169 117.767 8.40827C117.229 8.4193 116.696 8.51212 116.187 8.68351C115.226 9.01197 114.412 9.6646 113.886 10.5278C113.463 11.2175 113.184 11.9839 113.063 12.7821C112.976 13.3197 112.934 13.8635 112.938 14.408C112.938 16.3128 112.938 18.2182 112.938 20.1239C112.941 20.2516 112.933 20.3708 112.921 20.4857Z"
            fill="#003732" />
          <path
            d="M30.2334 20.5012C29.4844 20.541 28.7339 20.541 27.9849 20.5012C27.9849 20.4416 27.9678 20.3778 27.9649 20.3125C27.9649 20.2217 27.9649 20.1309 27.9649 20.0401V0.745703C27.9649 0.603833 27.9649 0.453448 27.9649 0.300227C28.2277 0.217942 28.4792 0.269019 28.7263 0.259088C28.9734 0.249157 29.2063 0.259088 29.4406 0.259088C29.6748 0.259088 29.9391 0.247735 30.2048 0.273272C30.2148 0.355556 30.2277 0.415149 30.2306 0.484666C30.2306 0.575463 30.2306 0.666258 30.2306 0.757055C30.2306 7.18852 30.2306 13.62 30.2306 20.0515C30.2391 20.1919 30.2363 20.3366 30.2334 20.5012Z"
            fill="#003732" />
        </svg>
      </div>
      <form name="login-form" @submit.prevent="login" class="flex flex-col w-4/5">
        <div>
          <h2 class="font-sans text-5xl font-extralight text-clever-green-100 mb-12">
            Velkommen til <br> Selvbetjening Erhverv
          </h2>
          <p class="text-gray-600 mb-5">
            Log ind med din brugerkonto</p>
        </div>
        <div class="form-group mb-4 ">
          <label for="email"></label>
          <input v-model="state.email" id="email" type="email" placeholder="Email*"
            class="w-full focus:outline-none p-4 border-solid border border-clever-green-60" />
          <div v-if="state.errors.email" class="error">{{ errors.email }}</div>
        </div>

        <div class="form-group mb-4 ">
          <label for="password"></label>
          <input v-model="state.password" id="password" type="password" placeholder="Adgangskode*"
            class="w-full focus:outline-none p-4 border-solid border border-clever-green-60" />
          <div v-if="state.errors.password" class="error">{{ errors.password }}</div>
        </div>

        <button type="submit" class="bg-clever-green-100 w-fit mb-2 py-2 px-5 text-clever-white">Log ind</button>
        <a href="#" class="forgot-password underline">Glemt adgangskode?</a>
      </form>
    </div>

    <div class="w-1/2 h-full"><img alt="Clever charger" src="../assets/images/clever-charger.png" class="" /></div>

  </div>

</template>


<style scoped></style>